{% extends 'blog/base_blog.html' %}
{% load martortags %}


{% block title %}
{{ post.title }} - {{ block.super }}     
{% endblock title %}


{% block content %}

<div class="card" style="width: 70rem;">
  <div class="card-header">{{ post.date_pub }}</div>
  {% if post.cover_url %}
  <img src="{{ post.cover_url }}" class="card-img-top" alt="Обложка">  
  {% endif %}
    <div class="card-body">
      
      <h5 class="card-title">{{ post.title }} - <a href="{% url 'user_page_url' post.author.id %}">{{ post.author }}</a></h5> 
      <p class="card-text">{{ post.body|safe_markdown|cut:'----------' }}</p>

      
        <form action="{% url 'like_post' post.pk %}" method="POST">
          {% csrf_token %}
        
          {% if  post.author != request.user and request.user.is_authenticated %}
          {% load extras %}
          {% likeOrNotTag post request.user as postlikeOrNotTag %}
            {% if postlikeOrNotTag %}
            <button type="submit" name="obj_id" value="{{ post.id }}" class="btn btn-outline-info">{{ post.total_likes }}</button>
            {% else %}
            <button type="submit" name="obj_id" value="{{ post.id }}" class="btn btn-info">{{ post.total_likes }}</button>
            {% endif %} 
          {% else %}
          <div class="btn btn-outline-info">{{ post.total_likes }}</div>      
          {% endif %}          
          
          {% if request.user == post.author %}        
          <a href="{{ post.get_update_url }}" class="btn btn-outline-primary">Редактировать</a>
          <a href="{{ post.get_delete_url }}" class="btn btn-outline-danger">Удалить</a>
          {% endif %}
        
        </form>
        
    </div>
    <div class="card-footer text-muted">
    
      {% for tag in post.tags.all %}
      <a href="{% url 'tag_detail_url' slug=tag.slug %}">#{{ tag }}</a>        
      {% endfor %}   
          
    </div>
    <br>
    <br>

    Всего комментариев: {{ comments.count }}
    <br>
    <br>
    {% for comment in comments %}
      {% include 'blog/includes/comment_card.html' %}
    {% endfor %}
    
    {% if request.user.is_authenticated %}
    <br>
    <br>
    {% include 'blog/includes/add_comment.html' %}      
    {% endif %}
      
      

  </div>



{% endblock content %}